# JavaScript 位运算符完全指南

## 1. 右移运算符 (>>) 详解

### 1.1 基本概念

右移运算符（`>>`）是一个二进制位运算符，它将一个数的二进制表示向右移动指定的位数。每右移一位，相当于将这个数除以 2 并向下取整。

### 1.2 语法

```javascript
number >> bitCount;
```

- `number`: 要进行右移操作的数值
- `bitCount`: 要右移的位数

### 1.3 运算规则

1. 将数字转换为二进制表示
2. 将二进制数整体向右移动指定的位数
3. 对于正数：左边补 0
4. 对于负数：左边补 1（保持负数符号）

### 1.4 示例

```javascript
// 正数右移
(10 >>
    (1 -
        // 10 的二进制：   1010
        // 右移1位后：     0101  (结果为 5)

        // 负数右移
        8)) >>
    1;
// -8 的二进制：   11111111111111111111111111111000
// 右移1位后：     11111111111111111111111111111100  (结果为 -4)
```

## 2. 其他位运算符

### 2.1 左移运算符 (<<)

- 将二进制位向左移动指定位数，右边补0
- 每左移一位相当于乘以2

```javascript
3 << 1; // 6  (二进制：11 -> 110)
3 << 2; // 12 (二进制：11 -> 1100)
```

### 2.2 无符号右移 (>>>)

- 与右移类似，但对负数处理不同
- 左边始终补0，不保留符号位

```javascript
-8 >>> 1; // 2147483644
8 >>> 1; // 4
```

### 2.3 按位与 (&)

- 两个操作数对应的二进制位都为1时，结果为1，否则为0

```javascript
5 & 3; // 1 (二进制：101 & 011 = 001)
```

### 2.4 按位或 (|)

- 两个操作数对应的二进制位至少有一个为1时，结果为1

```javascript
5 | 3; // 7 (二进制：101 | 011 = 111)
```

### 2.5 按位异或 (^)

- 两个操作数对应的二进制位不同时，结果为1

```javascript
5 ^ 3; // 6 (二进制：101 ^ 011 = 110)
```

### 2.6 按位非 (~)

- 反转所有二进制位（0变1，1变0）

```javascript
~5; // -6 (二进制：~00000101 = 11111010)
```

## 3. 常见应用场景

### 3.1 乘除运算

- 左移实现乘法：`n << 1` 等价于 `n * 2`
- 右移实现除法：`n >> 1` 等价于 `Math.floor(n / 2)`

### 3.2 判断奇偶

```javascript
if (n & 1) {
    console.log("奇数");
} else {
    console.log("偶数");
}
```

### 3.3 交换两个数

#### 3.3.1 使用异或运算交换

```javascript
// 假设初始值：
// a = 5 (二进制：101)
// b = 3 (二进制：011)

// 步骤1：a ^= b
a = a ^ b;
// a = 101 ^ 011 = 110 (6)
// b = 011 (3)

// 步骤2：b ^= a
b = b ^ a;
// a = 110 (6)
// b = 011 ^ 110 = 101 (5)

// 步骤3：a ^= b
a = a ^ b;
// a = 110 ^ 101 = 011 (3)
// b = 101 (5)
```

#### 3.3.2 原理解析

1. **第一步 `a ^= b`**：

    - 将 a 和 b 的值进行异或，存储在 a 中
    - 此时 a 保存了两个值的"差异信息"

2. **第二步 `b ^= a`**：

    - b 和新的 a（包含差异信息）进行异或
    - 由于异或运算的特性，这一步让 b 获得了原来 a 的值

3. **第三步 `a ^= b`**：
    - 新的 a（差异信息）和新的 b（原来的 a）进行异或
    - 得到原来的 b 值

#### 3.3.3 异或运算的特性

1. a ^ a = 0（任何数与自己异或等于0）
2. a ^ 0 = a（任何数与0异或等于自己）
3. a ^ b = b ^ a（交换律）
4. (a ^ b) ^ c = a ^ (b ^ c)（结合律）

#### 3.3.4 优缺点与替代方案

**优点：**

- 不需要额外的临时变量
- 在内存受限的嵌入式系统中很有用
- 在某些底层编程场景中性能更好

**缺点：**

- 代码可读性差
- 不如传统的使用临时变量交换方式直观
- 对代码维护和理解增加了难度

**推荐的替代方案：**

```javascript
// 1. 使用临时变量（最常用、最易读）
let temp = a;
a = b;
b = temp;

// 2. 使用数组解构（ES6+，简洁优雅）
[a, b] = [b, a];
```

### 3.4 取整

```javascript
console.log(~~3.14); // 3
console.log(~~-3.14); // -3
```

## 4. 性能考虑

1. **优点**

    - 位运算直接操作二进制，执行速度快
    - 在特定场景下可以替代一些数学运算

2. **缺点**
    - 代码可读性较差
    - 不是所有场景都适合使用位运算

## 5. 使用建议

1. 在性能关键的场景，可以考虑使用位运算
2. 使用位运算时，建议添加清晰的注释
3. 在普通业务代码中，优先考虑可读性，谨慎使用位运算
4. 处理大数据或底层算法时，位运算能带来明显的性能提升
